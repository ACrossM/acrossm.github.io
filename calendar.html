<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset='utf-8' />
<meta name='viewport' content='width=device-width, initial-scale=1.0' />
<title>貸出状況カレンダー</title>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
  body { font-family: 'Noto Sans JP', sans-serif; background-color: #fff; margin: 0; padding: 1em; }
  .custom-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5em; }
  .filter-container select { width: 320px; max-width: 100%; padding: 10px; font-size: 0.9em; border-radius: 8px; border: 1px solid #ccc; background-color: #fff; -webkit-appearance: none; appearance: none; background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23333"><path d="M7 10l5 5 5-5z"/></svg>'); background-repeat: no-repeat; background-position: right 12px center; background-size: 24px; cursor: pointer; }
  .navigation-container { display: flex; align-items: center; }
  .navigation-container h2 { font-size: 1.5em; font-weight: 700; color: #333; margin: 0 1em; }
  .nav-button { background-color: transparent; border: none; cursor: pointer; color: #455a64; font-size: 1.8em; line-height: 1; padding: 0 5px; }
  .fc { border: none; }
  .fc-col-header-cell { border: none; padding: 1em 0; font-weight: 500; color: #888; }
  .fc-daygrid-day { border: 1px solid #f0f0f0; }
  .fc-daygrid-day-number { padding: 0.5em; font-weight: 500; }
  .fc-day-today { background-color: #FFFBE6; }
  .fc-day-today .fc-daygrid-day-number { font-weight: 700; }
  .fc-event { background-color: #e0f2f7 !important; border-color: #b2ebf2 !important; padding: 2px 5px; font-weight: 500; font-size: 0.8em; cursor: pointer; margin-bottom: 4px !important; }
  .fc-event-main { color: #455a64 !important; }
  .fc-event.inflatable-event { background-color: #ffebee !important; border-color: #ffcdd2 !important; }
  .inflatable-event .fc-event-main { color: #c62828 !important; }
  @media (max-width: 600px) {
    .custom-header { flex-direction: column; gap: 15px; }
    .filter-container select { width: 100%; }
  }
</style>
</head>
<body>

  <div class="custom-header">
    <div class="filter-container">
  <select id="product-filter">
    <option value="all">すべての商品を表示</option>
    <optgroup label="アトラクション">
      <option value="電車DEスロット">電車DEスロット</option>
      <option value="AR釣りゲーム">AR釣りゲーム</option>
      <option value="縁日">縁日</option>
      <option value="縁日（やぐら付）">縁日（やぐら付）</option>
      <option value="うごく！ぬりえ">うごく！ぬりえ</option>
      <option value="カッティングレーサー">カッティングレーサー</option>
      <option value="キニナルゲームス">キニナルゲームス</option>
      <option value="段ボール迷路">段ボール迷路</option>
      <option value="ハンドスナイパー">ハンドスナイパー</option>
      <option value="プラレール">プラレール</option>
      <option value="ポップコーン">ポップコーン</option>
      <option value="メッシュビジョン">メッシュビジョン</option>
      <option value="わたがし">わたがし</option>
    </optgroup>
    <optgroup label="インフレーター">
      <option value="inflatables">インフレーター（すべて）</option>
      <option value="パンダ">パンダ</option>
      <option value="ゴリラ">ゴリラ</option>
      <option value="恐竜">恐竜</option>
      <option value="ユニコーン">ユニコーン</option>
      <option value="サンタクロース">サンタクロース</option>
      <option value="逆立ちピエロ">逆立ちピエロ</option>
      <option value="ハロウィンかぼちゃ">ハロウィンかぼちゃ</option>
    </optgroup>
  </select>
</div>
    <div class="navigation-container">
      <button id="prev-button" class="nav-button">&lt;</button>
      <h2 id="calendar-title"></h2>
      <button id="next-button" class="nav-button">&gt;</button>
    </div>
  </div>

  <div id='calendar'></div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const calendarEl = document.getElementById('calendar');
      const gasWebAppUrl = 'https://script.google.com/macros/s/AKfycbzuwcfA--IUZAXBSet2jB5kyGMFch9bcJ_C62xMHiV-afdxZ8DUa1--maQnMyKlC7F5/exec';
      const inflatableItems = ['パンダ', 'ゴリラ', '恐竜', 'ユニコーン', 'サンタクロース', '逆立ちピエロ', 'ハロウィンかぼちゃ'];
      let allEventsCache = [];

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'ja',
        headerToolbar: false,
        displayEventTime: false,
        
        // ★★★ カレンダーの高さをコンテンツに合わせて自動調整する設定 ★★★
        height: 'auto',

        datesSet: function(dateInfo) {
          document.getElementById('calendar-title').textContent = dateInfo.view.title;
        },
        events: function(fetchInfo, successCallback, failureCallback) {
          if (allEventsCache.length > 0) {
            successCallback(filterEvents(allEventsCache));
          } else {
            fetch(gasWebAppUrl).then(response => response.json()).then(allEvents => {
              allEventsCache = allEvents;
              successCallback(filterEvents(allEventsCache));
            }).catch(error => failureCallback(error));
          }
        }
      });
      calendar.render();

      function filterEvents(events) {
        const selectedValue = document.getElementById('product-filter').value;
        if (selectedValue === 'all') return events;
        if (selectedValue === 'inflatables') return events.filter(event => inflatableItems.includes(event.title));
        return events.filter(event => event.title === selectedValue);
      }

      document.getElementById('prev-button').addEventListener('click', () => { calendar.prev(); });
      document.getElementById('next-button').addEventListener('click', () => { calendar.next(); });
      document.getElementById('product-filter').addEventListener('change', () => {
        calendar.removeAllEvents();
        calendar.addEventSource(filterEvents(allEventsCache));
      });
    });
  </script>
</body>
</html>
