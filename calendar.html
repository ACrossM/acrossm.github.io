<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset='utf-8' />
<meta name='viewport' content='width=device-width, initial-scale=1.0' />
<title>貸出状況カレンダー</title>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
  body { font-family: 'Noto Sans JP', sans-serif; background-color: #fff; margin: 0; padding: 1em; }
  .filter-group { margin-bottom: 1em; padding: 15px; background-color: #f9f9f9; border-radius: 8px; }
  .filter-group h3 { font-size: 1em; font-weight: 700; margin-top: 0; margin-bottom: 10px; color: #333; border-bottom: 2px solid #FFD700; padding-bottom: 5px; }
  .filter-items { display: flex; flex-wrap: wrap; gap: 10px; }
  .filter-items label { display: flex; align-items: center; cursor: pointer; padding: 5px 10px; border-radius: 6px; transition: background-color 0.2s ease; font-size: 0.9em; }
  .filter-items input { margin-right: 8px; accent-color: #FFD700; }
  .filter-items label:hover { background-color: #f0f0f0; }
  .toggle-buttons { margin-bottom: 15px; display: flex; gap: 10px; }
  .toggle-buttons button { background-color: #e0e0e0; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8em; font-weight: 500; color: #455a64; }
  .toggle-buttons button:hover { background-color: #d0d0d0; }
  .fc { border: none; }
  .fc-header-toolbar { margin-bottom: 1.5em !important; }
  .fc-toolbar-title { font-size: 1.5em; font-weight: 700; color: #333; }
  .fc-button { background-color: #f0f0f0; border: none; border-radius: 8px; padding: 0.5em 1em; font-weight: 500; transition: background-color 0.2s ease; text-transform: capitalize; color: #455a64; }
  .fc-button:hover { background-color: #e0e0e0; }
  .fc-button-primary:not(:disabled).fc-button-active, .fc-today-button { background-color: #FFD700 !important; color: #333 !important; font-weight: 700; }
  .fc-button-primary:not(:disabled).fc-button-active:hover, .fc-today-button:hover { background-color: #f0c400 !important; }
  .fc-col-header-cell { border: none; padding: 1em 0; font-weight: 500; color: #888; }
  .fc-daygrid-day { border: 1px solid #f0f0f0; }
  .fc-daygrid-day-number { padding: 0.5em; font-weight: 500; }
  .fc-day-today { background-color: #FFFBE6; }
  .fc-day-today .fc-daygrid-day-number { font-weight: 700; }
  /* 通常イベントのスタイル */
  .fc-event { background-color: #e0f2f7 !important; border-color: #b2ebf2 !important; padding: 2px 5px; font-weight: 500; font-size: 0.8em; cursor: pointer; margin-bottom: 4px !important; }
  .fc-event-main { color: #455a64 !important; }
  .fc-list-event-dot { border-color: #FFD700 !important; }
  /* インフレーターイベントの色を上書き */
  .fc-event.inflatable-event { background-color: #ffebee !important; border-color: #ffcdd2 !important; }
  .inflatable-event .fc-event-main { color: #c62828 !important; }
</style>
</head>
<body>

  <div class="toggle-buttons">
    <button id="check-all">すべて選択</button>
    <button id="uncheck-all">すべて解除</button>
  </div>

  <div class="filter-group">
    <h3>表示フィルター</h3>
    <div class="filter-items" id="filter-container">
      <label><input type="checkbox" id="inflatables-toggle" name="product_group" value="inflatables" checked> インフレーター（すべて）</label>
      <label><input type="checkbox" name="product" value="電車DEスロット" checked> 電車DEスロット</label>
      <label><input type="checkbox" name="product" value="AR釣りゲーム" checked> AR釣りゲーム</label>
      <label><input type="checkbox" name="product" value="縁日" checked> 縁日</label>
      <label><input type="checkbox" name="product" value="縁日（やぐら付）" checked> 縁日（やぐら付）</label>
      <label><input type="checkbox" name="product" value="うごく！ぬりえ" checked> うごく！ぬりえ</label>
      <label><input type="checkbox" name="product" value="カッティングレーサー" checked> カッティングレーサー</label>
      <label><input type="checkbox" name="product" value="キニナルゲームス" checked> キニナルゲームス</label>
      <label><input type="checkbox" name="product" value="段ボール迷路" checked> 段ボール迷路</label>
      <label><input type="checkbox" name="product" value="ハンドスナイパー" checked> ハンドスナイパー</label>
      <label><input type="checkbox" name="product" value="プラレール" checked> プラレール</label>
      <label><input type="checkbox" name="product" value="ポップコーン" checked> ポップコーン</label>
      <label><input type="checkbox" name="product" value="メッシュビジョン" checked> メッシュビジョン</label>
      <label><input type="checkbox" name="product" value="わたがし" checked> わたがし</label>
    </div>
  </div>

  <div id='calendar'></div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const calendarEl = document.getElementById('calendar');
      // ★★★ 新しいURLを反映しました ★★★
      const gasWebAppUrl = 'https://script.google.com/macros/s/AKfycbxqfWShieOHa7s6L9c6nDAH_Vp4cdsbwo2wBrxEyo5Xpro-LazsLNFCUK2pRckhhS58aw/exec';
      const inflatableItems = ['パンダ', 'ゴリラ', '恐竜', 'ユニコーン', 'サンタクロース', '逆立ちピエロ', 'ハロウィンかぼちゃ'];
      let allEventsCache = [];

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'ja',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,listWeek'
        },
        buttonText: { today: '今日', month: '月', list:  'リスト' },
        displayEventTime: false,
        events: function(fetchInfo, successCallback, failureCallback) {
          if (allEventsCache.length > 0) {
            successCallback(filterEvents(allEventsCache));
          } else {
            fetch(gasWebAppUrl)
              .then(response => response.json())
              .then(allEvents => {
                allEventsCache = allEvents;
                successCallback(filterEvents(allEventsCache));
              })
              .catch(error => failureCallback(error));
          }
        }
      });

      calendar.render();

      function filterEvents(events) {
        let productsToShow = [];
        document.querySelectorAll('input[name="product"]:checked').forEach(input => {
          productsToShow.push(input.value);
        });
        if (document.querySelector('#inflatables-toggle:checked')) {
          productsToShow.push(...inflatableItems);
        }
        return events.filter(event => productsToShow.includes(event.title));
      }

      const allCheckboxes = document.querySelectorAll('#filter-container input[type="checkbox"]');
      allCheckboxes.forEach(input => {
        input.addEventListener('change', () => {
          calendar.removeAllEvents();
          calendar.addEventSource(filterEvents(allEventsCache));
        });
      });

      document.getElementById('check-all').addEventListener('click', () => {
        allCheckboxes.forEach(checkbox => checkbox.checked = true);
        calendar.removeAllEvents();
        calendar.addEventSource(filterEvents(allEventsCache));
      });

      document.getElementById('uncheck-all').addEventListener('click', () => {
        allCheckboxes.forEach(checkbox => checkbox.checked = false);
        calendar.removeAllEvents();
        calendar.addEventSource(filterEvents(allEventsCache));
      });
    });
  </script>
</body>
</html>
